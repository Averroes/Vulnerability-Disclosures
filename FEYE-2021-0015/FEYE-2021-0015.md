# FEYE-2021-0015
## Description
All SonicWall Email Security versions up to 10.0.9.6173 (Windows) and 10.0.9.6177 (Hardware & ESXi Virtual Appliances) contains a vulnerability in its branding feature that enables an attacker with an administrative role to upload an arbitrary file. The file can also be placed in an arbitrary location via a Zip Slip attack.

## Impact
High - an attacker could upload malicious code to the system running the SonicWall Email Security application.

## Exploitability
High - when used in conjuction with CVE-2021-20021.

## CVE Reference
CVE-2021-20022

## Technical Details
The SonicWall Email Security product includes a feature called Branding, designed to allow administrators to customize aspects of the user interface. Administrators can upload ZIP files known as branding packages which contain custom text, image, and layout settings. A lack of ZIP file data validation can enable an attacker to upload arbitrary files, including executable code, such as web shells.

Once uploaded, branding package ZIP archives are expanded and saved to the `<install path>\data\branding` directory. By crafting a ZIP archive containing a file within a sequence of directory traversal notations (i.e., `\..\..\..\..\..\..\path\to\target\dir\webshell.jsp`), otherwise known as a Zip Slip attack, attackers can place malicious files in arbitrary locations, such as a web accessible Apache Tomcat directory.

## Resolution
SonicWall recommends upgrading Email Security to version 10.0.9.6173 (Windows) or 10.0.9.6177 (Hardware & ESXi Virtual Appliances). Organizations using SonicWall Hosted Email Security (HES) products were automatically updated and no action is required for those customers.

## Discovery Credits
- Josh Fleischer, FireEye Mandiant
- Chris DiGiamo, FireEye Mandiant

## Disclosure Timeline
26-Mar-2021 – Vulnerability Identified through in-the-wild exploitation
26-Mar-2021 – Contacted SonicWall PSIRT
09-Apr-2021 - Security patch released by SonicWall

## References
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-20022
- https://www.fireeye.com/blog/threat-research/2021/04/zero-day-exploits-in-sonicwall-email-security-lead-to-compromise.html