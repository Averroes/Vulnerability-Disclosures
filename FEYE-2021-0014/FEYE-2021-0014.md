# FEYE-2021-0014
## Description
All SonicWall Email Security versions up to 10.0.9.6173 (Windows) and 10.0.9.6177 (Hardware & ESXi Virtual Appliances) contains a vulnerability enabling an attacker to create a new `role.ouadmin` administrative account by sending HTTP requests containing crafted XML data to an exposed unauthenticated API.

## Impact
High - an unauthenticated attacker could remotely gain administrative user access to the SonicWall Email Security application.

## Exploitability
High - Internet-reachable SonicWall Email Security applications can be exploited without prior authentication.

## CVE Reference
CVE-2021-20021

## Technical Details
The SonicWall Email Security application contains an authenticated control panel to provide administration capabilities. One feature available allows application administrators to authorize an additional administrator account from a separate Microsoft Active Directory Organization Unit (AD OU). This functionality is implemented in the `com.mailfrontier.msgcenter.app.api.hosted.ActivateAccount` Java class and available through the `/createou` HTTP URI.

Requests to this form, however, are not verified to require previous authentication to the appliance.

Due to this vulnerability, an attacker with a well-crafted XML document can either GET or POST their document to the application and create a `role.ouadmin` account:

* `https://<SonicWall ES host>/createou?data=<XML HERE>`

This account can then be used to authenticate to the application as an administrator.

## Resolution
SonicWall recommends upgrading Email Security to version 10.0.9.6173 (Windows) or 10.0.9.6177 (Hardware & ESXi Virtual Appliances). Organizations using SonicWall Hosted Email Security (HES) products were automatically updated and no action is required for those customers.

## Discovery Credits
- Josh Fleischer, FireEye Mandiant
- Chris DiGiamo, FireEye Mandiant

## Disclosure Timeline
- 26-Mar-2021 – Vulnerability Identified through in-the-wild exploitation
- 26-Mar-2021 – Contacted SonicWall PSIRT
- 09-Apr-2021 - Security patch released by SonicWall

 
## References
- [Mitre: CVE-2021-20021](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-20021)
- [FireEye Blog: Zero-Day Exploits in SonicWall Email Security Lead to Enterprise Compromise](https://www.fireeye.com/blog/threat-research/2021/04/zero-day-exploits-in-sonicwall-email-security-lead-to-compromise.html)