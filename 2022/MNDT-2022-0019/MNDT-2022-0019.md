# MNDT-2022-0019
Schneider Electric (SE) ClearSCADA all versions, EcoStruxure Geo SCADA Expert 2019 all versions, and EcoStruxure Geo SCADA Expert 2020 all versions; an Improper Certificate Validation vulnerability exists that could allow a Man-in-the-Middle attack when communications between the client application and a Geo SCADA server are intercepted.

## Impact
High - All data communicated between the client application and the server are able to be observed, and modified. This includes login credentials, and sensor alarm data.

## Exploitability
Medium - The attacker must be in an active traffic interception position. The attacker must then reverse engineer the communications protocol between the client and server in order to decrypt, and modify the data.

## CVE Reference
CVE-2022-24320

## Common Weakness Enumeration (CWE)
A CWE-295: Improper Certificate Validation vulnerability exists that could allow a Man-in-the-Middle attack when communications between the client and Geo SCADA server are intercepted.

## Common Vulnerability Scoring System (CVSS)
CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:U/C:H/I:L/A:L

## Technical Details
Before the client conducts the authentication handshake, all messages between the client and server are checked for integrity using a basic CRC – if the calculated CRC is invalid, then the communication is terminated. After the authentication handshake is completed, messages are encrypted and authenticated with ‘session’ keys derived from the authentication handshake.

The session keys are derived using several random values provided by both the client and server during the handshake, and passed to a pseudo-random function to generate enough key material for separate initialization, encryption, and authentication keys for both read and write operations. Most of these values are in cleartext in the stream, however one value (client nonce) sent from the client to the server is encrypted with the certificate provided by the server early in the handshake sequence.

Mandiant determined that even with a sufficiently strong RSA key, an attacker who is able to replace the server’s public key with their own would be able to then decrypt the encrypted client nonce, re-encrypt it with the legitimate server key, and relay all other messages between the client and server. 

Mandiant was able to leverage this issue to extract plaintext credentials from the traffic stream between a ViewX Client and Geo Scada Expert Server

## Resolution
Update to version 84.

## Discovery Credits
- Cameron Stokes, Mandiant

## Disclosure Timeline
- 25 May 2021 - Initial contact with SE to discuss disclosure process
- 29 June 2021 - Information provided to SE
- 29 June 2021 - SE acknowledged receipt with ref ID 4701
- 20 July 2021 - SE indicated issue was a duplicate of an existing report
- 29 July 2021 - Request for update
- 29 July 2021 - Planned release in Q4 2021
- 3 November 2021 - Release targeted end of November
- 28 January 2022 - Release targeted for March
- 9 February 2022 - SE published notification for ref ID 4701
 
## References
- https://www.se.com/ww/en/download/document/SEVD-2022-039-05/
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24320
