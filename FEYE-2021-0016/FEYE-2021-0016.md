# FEYE-2021-0016
## Description
All SonicWall Email Security versions up to 10.0.9.6173 (Windows) and 10.0.9.6177 (Hardware & ESXi Virtual Appliances) contains a vulnerability in its branding feature that enables an authenticated attacker to read an arbitrary file from the host.

## Impact
Medium - affects confidentiality of the system.

## Exploitability
High - when used in conjuction with CVE-2021-20021.

## CVE Reference
CVE-2021-20023

## Technical Details
The SonicWall Email Security product includes a feature called Branding, designed to allow administrators to customize aspects of the user interface. A post-authenticated attacker can download arbitrary files from the host by crafting an HTTP GET request to a particular resource related to the branding feature:

* `http://192.168.1.100/dload_apps?action=test&path=..%2F..%2F..%2F..%2F..%2Fwindows%2Fsystem32%2Fcalc.exe&id=update`
**    The “action” parameter can be set to any value
**    The “path” parameter specifies the path and filename of the target file, relative to the working directory

The working directory of this branding feature is `<ES install path>\data\updates`. Attackers can request files located outside of this directory by providing directory traversal notations in the path parameter of the HTTP request. The webserver that handles this request is operating as the `NT Authority\SYSTEM` account, which allows access to any file on the operating system.

The JavaScript file responsible for this functionality is located in `<ES install path>\Apache Software Foundation\Tomcat 9.0\webapps\ROOT\scripts\js\modules\SWL.settings_branding.js`.

## Resolution
SonicWall recommends upgrading Email Security to version 10.0.9.6173 (Windows) or 10.0.9.6177 (Hardware & ESXi Virtual Appliances). Organizations using SonicWall Hosted Email Security (HES) products were automatically updated and no action is required for those customers.

## Discovery Credits
- Josh Fleischer, FireEye Mandiant
- Chris DiGiamo, FireEye Mandiant

## Disclosure Timeline
05-Apr-2021 – Vulnerability Identified through in-the-wild exploitation
06-Apr-2021 – Contacted SonicWall PSIRT
19-Apr-2021 – Security patch released by SonicWall 

## References
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-20023
- https://www.fireeye.com/blog/threat-research/2021/04/zero-day-exploits-in-sonicwall-email-security-lead-to-compromise.html